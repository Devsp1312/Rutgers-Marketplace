<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Marketplace</title>
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
    rel="stylesheet"
  />
  <style>
    body {
      background-color: #e1dfd2;
      margin: 0;
      padding: 0;
    }
    .navbar-custom {
      background-color: #393b3f; /* Gray */
    }
    .navbar-custom .navbar-brand,
    .navbar-custom .nav-link,
    .navbar-custom .dropdown-toggle,
    .navbar-custom .btn {
      color: #fff !important;
    }
    /* Outline style for Filter on gray */
    .navbar-custom .btn-outline-light {
      border-color: #fff;
      color: #fff;
    }
    .navbar-custom .btn-outline-light:hover {
      background-color: #fff;
      color: #393b3f;
    }

    /* Single user icon button for dropdown */
    .user-icon-btn {
      background: transparent;
      border: none;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px; /* space between icon and greeting */
    }
    .user-icon-btn:hover {
      background-color: rgba(255,255,255,0.2);
    }

    .user-icon-btn img {
      height: 32px;
      width: auto;
    }

    /* Greeting text in white */
    .greeting {
      color: #fff;
      font-weight: bold;
    }

    .logo-img {
      height: 40px;
      width: auto;
    }
    .card-img-top {
      height: 200px;
      object-fit: cover;
    }
  </style>
</head>

<body>
  <!-- Sticky Navbar -->
  <nav class="navbar navbar-expand-lg navbar-custom sticky-top mb-3">
    <div class="container-fluid">
      <!-- Logo + Title -->
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img 
          src="/FrontEnd/Images/RuMarketplaceLogo.png" 
          alt="RU Marketplace" 
          class="logo-img"
        />
        <span class="ms-2 fw-bold">RU-Marketplace</span>
      </a>

      <!-- Search & Filter -->
      <div class="d-flex align-items-center ms-auto me-3">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search..." />
          <button class="btn btn-outline-light">Filter</button>
        </div>
      </div>

      <!-- User Icon Dropdown -->
      <div class="dropdown me-3">
        <button 
          class="user-icon-btn dropdown-toggle" 
          type="button" 
          data-bs-toggle="dropdown" 
          aria-expanded="false"
          id="userIconBtn"
        >
          <!-- Placeholder user icon -->
          <img src="/FrontEnd/Images/user.png" alt="User Icon" />
          <!-- Greeting text, if logged in -->
          <span id="greeting" class="greeting"></span>
        </button>
        <ul class="dropdown-menu" id="userDropdownMenu"></ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- Product Grid -->
    <div class="row" id="product-grid"></div>
  </div>

  <!-- Bootstrap Bundle -->
  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  ></script>

  <script>
    // Hardcoded products
    const products = [
      {
        title: "Gaming PC",
        description: "High-performance gaming PC with RTX 3080.",
        price: 1499,
        image: "/FrontEnd/Images/gamingpc.png"
      },
      {
        title: "iPhone 14 Pro",
        description: "Brand new iPhone 14 Pro with 256GB storage.",
        price: 1099,
        image: "/FrontEnd/Images/iphone.png"
      },
      {
        title: "Electric Scooter",
        description: "Fast and efficient electric scooter for city travel.",
        price: 599,
        image: "/FrontEnd/Images/electricscooter.png"
      },
      {
        title: "Sony Headphones",
        description: "Noise-canceling over-ear headphones with deep bass.",
        price: 299,
        image: "/FrontEnd/Images/sony.png"
      },
      {
        title: "LED Wall Lights",
        description: "Colorful LED strips to decorate your dorm.",
        price: 20,
        image: "/FrontEnd/Images/ledwalllights.png"
      },
      {
        title: "Parking Pass",
        description: "Valid on-campus parking pass for the semester.",
        price: 100,
        image: "/FrontEnd/Images/parkingpass.png"
      },
      {
        title: "Dorm Chair",
        description: "Comfortable chair for your desk or lounge.",
        price: 30,
        image: "/FrontEnd/Images/dormchair.png"
      },
      {
        title: "Laptop",
        description: "Lightweight laptop, perfect for note-taking and research.",
        price: 700,
        image: "/FrontEnd/Images/laptop.png"
      },
      {
        title: "Mini Fridge",
        description: "Keep snacks and drinks cool in your dorm.",
        price: 75,
        image: "/FrontEnd/Images/minifridge.png"
      },
      {
        title: "Microwave",
        description: "Compact microwave for quick dorm meals.",
        price: 50,
        image: "/FrontEnd/Images/microwave.png"
      },
      {
        title: "Textbooks",
        description: "Various textbooks from core and elective classes.",
        price: 80,
        image: "/FrontEnd/Images/textbooks.png"
      },
      {
        title: "Calculator",
        description: "Scientific calculator for math and science courses.",
        price: 15,
        image: "/FrontEnd/Images/calculator.png"
      },
      {
        title: "Backpack",
        description: "Durable backpack with multiple compartments.",
        price: 25,
        image: "/FrontEnd/Images/backpack.png"
      },
      {
        title: "Mechanical Keyboard",
        description: "Tactile mechanical keyboard for a satisfying typing experience.",
        price: 40,
        image: ""
      },
      {
        title: "Wireless Mouse",
        description: "Reliable wireless mouse for everyday use.",
        price: 20,
        image: ""
      },
      {
        title: "Bean Bag Chair",
        description: "Cozy bean bag seat, perfect for dorm lounging.",
        price: 45,
        image: ""
      },
      {
        title: "Gaming Headset",
        description: "Over-ear headset with microphone for online gaming.",
        price: 60,
        image: ""
      },
      {
        title: "Monitor",
        description: "24-inch 1080p monitor, great for gaming or productivity.",
        price: 120,
        image: ""
      },
      {
        title: "Dorm Lamp",
        description: "Adjustable desk lamp for late-night study sessions.",
        price: 10,
        image: ""
      },
      {
        title: "Bike",
        description: "Used bike, ideal for commuting around campus.",
        price: 120,
        image: ""
      }
    ];

    document.addEventListener("DOMContentLoaded", () => {
      renderProducts();
      setupUserIconDropdown();
    });

    function renderProducts() {
      const productGrid = document.getElementById("product-grid");
      productGrid.innerHTML = "";

      products.forEach(product => {
        const colDiv = document.createElement("div");
        colDiv.classList.add("col-sm-6", "col-md-4", "col-lg-3", "mb-4");

        colDiv.innerHTML = `
          <div class="card h-100">
            <img 
              src="${product.image}"
              class="card-img-top"
              alt="${product.title}"
            />
            <div class="card-body">
              <h5 class="card-title">${product.title}</h5>
              <p class="card-text">${product.description}</p>
              <p class="text-success">$${product.price}</p>
              <button class="btn btn-success" onclick="buyNow(
                '${product.title}',
                '${product.description}',
                '${product.price}',
                '${product.image}'
              )">Buy Now</button>
            </div>
          </div>
        `;
        productGrid.appendChild(colDiv);
      });
    }

    function setupUserIconDropdown() {
      const greetingEl = document.getElementById("greeting");
      const userDropdownMenu = document.getElementById("userDropdownMenu");

      // Check localStorage for login state
      const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
      const username = localStorage.getItem("username") || "";

      // Clear the dropdown
      userDropdownMenu.innerHTML = "";

      if (isLoggedIn && username) {
        // Show "Hello, username!"
        greetingEl.textContent = `Hello, ${username}!`;

        // Dropdown items: Profile + Logout
        userDropdownMenu.innerHTML = `
          <li><a class="dropdown-item" href="profile.html">Profile</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" id="logoutLink" href="#">Logout</a></li>
        `;
      } else {
        // Not logged in => no greeting
        greetingEl.textContent = "";

        // Dropdown item: Login
        userDropdownMenu.innerHTML = `
          <li><a class="dropdown-item" id="loginLink" href="#">Login</a></li>
        `;
      }

      // Attach event listeners for login or logout
      const loginLink = document.getElementById("loginLink");
      if (loginLink) {
        loginLink.addEventListener("click", () => {
          window.location.href = "signin.html";
        });
      }

      const logoutLink = document.getElementById("logoutLink");
      if (logoutLink) {
        logoutLink.addEventListener("click", () => {
          // Clear login state
          localStorage.removeItem("isLoggedIn");
          localStorage.removeItem("username");
          // Reload page to reflect changes
          location.reload();
        });
      }
    }

    function buyNow(title, description, price, image) {
      const query = new URLSearchParams({
        title,
        description,
        price,
        image
      }).toString();
      window.location.href = `Product.html?${query}`;
    }
  </script>
</body>
</html>

