<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <!-- Bootstrap CSS -->
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
    rel="stylesheet"
  />
</head>
<body>
  <div class="container mt-4">
    <h1>Admin Dashboard</h1>

    <!-- Only the Reports tab is enabled -->
    <ul class="nav nav-tabs" id="adminTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button 
          class="nav-link active" 
          id="reports-tab" 
          data-bs-toggle="tab" 
          data-bs-target="#reports" 
          type="button" role="tab"
          aria-controls="reports" 
          aria-selected="true"
        >
          Reports
        </button>
      </li>
    </ul>

    <div class="tab-content mt-3" id="adminTabsContent">
      <!-- Reports Tab -->
      <div 
        class="tab-pane fade show active" 
        id="reports" 
        role="tabpanel" 
        aria-labelledby="reports-tab"
      >
        <h3>Reported Listings</h3>
        <table class="table table-bordered" id="reportsTable">
          <thead>
            <tr>
              <th>Report ID</th>
              <th>Reason</th>
              <th>Created At</th>
              <th>View Listing</th>
            </tr>
          </thead>
          <tbody>
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  ></script>

  <script>
    async function loadReports() {
      try {
        const res = await fetch('http://localhost:3000/api/reports');
        if (!res.ok) throw new Error(`Error: ${res.status}`);
        const reports = await res.json();
        renderReports(reports);
      } catch (err) {
        console.error('Could not load reports:', err);
        document.querySelector('#reportsTable tbody').innerHTML =
          `<tr><td colspan="4" class="text-danger">Failed to load reports.</td></tr>`;
      }
    }

    function renderReports(reports) {
  const tbody = document.querySelector('#reportsTable tbody');
  tbody.innerHTML = '';

  if (!reports.length) {
    tbody.innerHTML = `<tr><td colspan="4">No reports found.</td></tr>`;
    return;
  }

  reports.forEach(r => {
    const tr = document.createElement('tr');

    const idCell = document.createElement('td');
    idCell.textContent = r._id;
    tr.appendChild(idCell);

    const reasonCell = document.createElement('td');
    reasonCell.textContent = r.reason;
    tr.appendChild(reasonCell);

    const dateCell = document.createElement('td');
    dateCell.textContent = new Date(r.createdAt).toLocaleString();
    tr.appendChild(dateCell);
    const viewCell = document.createElement('td');
    const link = document.createElement('a');

    const listingId = typeof r.listingId === 'object'
      ? r.listingId._id
      : r.listingId;

    link.href = `Product.html?id=${listingId}`;
    link.textContent = 'View';
    link.className = 'btn btn-sm btn-outline-primary';
    viewCell.appendChild(link);
    tr.appendChild(viewCell);

    tbody.appendChild(tr);
  });
}
    document.addEventListener('DOMContentLoaded', loadReports);
  </script>
</body>
</html>
